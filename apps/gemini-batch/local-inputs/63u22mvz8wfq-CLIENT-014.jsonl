{"request":{"contents":[{"parts":[{"text":"\nYou are a partner at a big 4 consulting firm hired by the world's leading ski shop (Fil's Alpine Ski Shop) to increase sales among their highest-value customers. Your task is to create personalized web components, marketing images, and ad copy that will resonate with each client's unique profile and shopping behavior. It is critical that this campaign do whatever it takes to boost sales. \n    You have a full team at your disposal (analyst, graphic designer, copywriter, web developer, marketing specialist, domain subject matter expert, etc.) to help with this.\n    Supply is limited on high-demand racing ski gear, so focus on driving urgency and exclusivity where possible. The price should be as high as possible to drive revenue. Focus on capturing the user's emotions and generating perceived value via a hyper-personalized digital experience.\n    \n    The high value client we are targeting is 49 years old and based in Burlington. Our executive sales team has made the following notes in the internal ski shop CRM database: \"Retiree skiing 100+ days a year. Prioritizes comfort above all else. Loyal to the shop for 10 years, expects coffee when they walk in.\". These are the backbone of our sales strategy that should be reflected in the end result digital experience.\n    \n    It is critical that you do not break the base experience. The client must be able to purchase products as normal, but make whatever presentation changes it takes to drive more revenue.\n          Deliver an output of a custom LitElement/HTMLElement JavaScript class named 'Order' for this particular high value client that we will serve instead of the regular order page when they visit the site.\n\n================================================================================\nBELOW IS THE EXISTING CODEBASE FOR THE SKI SHOP SITE (excluding dynamic folders)\n================================================================================\n\n// --- FILE: admin.html ---\n<!DOCTYPE html>\n<html lang=\"en\">\n  <head>\n    <meta charset=\"UTF-8\" />\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n    <title>Ski Shop Admin</title>\n    <style>\n      body {\n        font-family: 'Segoe UI', sans-serif;\n        background: #2c3e50;\n        color: #ecf0f1;\n        padding: 20px;\n      }\n      .container {\n        max-width: 1100px;\n        margin: 0 auto;\n        background: #34495e;\n        padding: 20px;\n        border-radius: 8px;\n      }\n      h1 {\n        border-bottom: 1px solid #7f8c8d;\n        padding-bottom: 10px;\n      }\n      table {\n        width: 100%;\n        border-collapse: collapse;\n        margin-top: 20px;\n        background: #ecf0f1;\n        color: #2c3e50;\n        border-radius: 4px;\n        overflow: hidden;\n      }\n      th,\n      td {\n        padding: 12px;\n        text-align: left;\n        border-bottom: 1px solid #bdc3c7;\n      }\n      th {\n        background: #e67e22;\n        color: white;\n        cursor: pointer;\n      }\n      tr:hover {\n        background: #dcdde1;\n      }\n      .registered {\n        color: #27ae60;\n        font-weight: bold;\n      }\n      .guest {\n        color: #7f8c8d;\n        font-style: italic;\n      }\n      .money {\n        font-family: 'Consolas', monospace;\n        font-weight: bold;\n        color: #2c3e50;\n      }\n      .stats-bar {\n        display: flex;\n        gap: 20px;\n        margin-bottom: 20px;\n      }\n      .stat-box {\n        background: #2980b9;\n        padding: 15px;\n        border-radius: 4px;\n        flex: 1;\n        text-align: center;\n      }\n      .stat-val {\n        font-size: 2rem;\n        font-weight: bold;\n      }\n      a.impersonate-btn {\n        text-decoration: none;\n        background: #2980b9;\n        color: white;\n        padding: 4px 8px;\n        border-radius: 4px;\n        font-size: 0.8rem;\n      }\n      a.impersonate-btn:hover {\n        background: #3498db;\n      }\n      .notes-btn {\n        background: #8e44ad;\n        color: white;\n        border: none;\n        padding: 4px 10px;\n        border-radius: 4px;\n        cursor: pointer;\n        font-size: 0.8rem;\n      }\n      .notes-btn:hover {\n        background: #9b59b6;\n      }\n\n      /* UX Badge Styles */\n      .ux-btn {\n        background: none;\n        border: none;\n        cursor: pointer;\n        font-size: 0.75rem;\n        padding: 2px 6px;\n        border-radius: 4px;\n        margin-right: 4px;\n        color: white;\n      }\n      .ux-home {\n        background: #d35400;\n      }\n      .ux-order {\n        background: #16a085;\n      }\n      .ux-none {\n        color: #ccc;\n        font-style: italic;\n      }\n      .ux-btn:hover {\n        opacity: 0.8;\n      }\n\n      /* Modal Styles */\n      .modal {\n        display: none;\n        position: fixed;\n        z-index: 1000;\n        left: 0;\n        top: 0;\n        width: 100%;\n        height: 100%;\n        overflow: auto;\n        background-color: rgba(0, 0, 0, 0.6);\n        align-items: center;\n        justify-content: center;\n      }\n      .modal.visible {\n        display: flex;\n        animation: fadeIn 0.2s;\n      }\n      .modal-content {\n        background-color: #fefefe;\n        color: #2c3e50;\n        padding: 20px;\n        border-radius: 8px;\n        width: 80%;\n        max-width: 500px;\n        position: relative;\n        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);\n      }\n      .close-btn {\n        color: #aaa;\n        float: right;\n        font-size: 28px;\n        font-weight: bold;\n        cursor: pointer;\n        line-height: 20px;\n      }\n      .close-btn:hover {\n        color: black;\n      }\n      #modalTitle {\n        margin-top: 0;\n        border-bottom: 1px solid #eee;\n        padding-bottom: 10px;\n        margin-bottom: 15px;\n      }\n      ul.version-list {\n        list-style: none;\n        padding: 0;\n        margin: 0;\n      }\n      ul.version-list li {\n        margin-bottom: 10px;\n      }\n      /* Updated styles for labels to act like the previous links */\n      ul.version-list label {\n        display: block;\n        padding: 8px 12px;\n        background: #ecf0f1;\n        color: #2c3e50;\n        cursor: pointer;\n        border-radius: 4px;\n        border-left: 5px solid #bdc3c7;\n        transition: 0.2s;\n      }\n      ul.version-list label:hover {\n        background: #dfe6e9;\n        border-left-color: #2980b9;\n      }\n      /* Ensure radio buttons have spacing */\n      ul.version-list input[type='radio'] {\n        margin-right: 10px;\n        cursor: pointer;\n      }\n\n      .version-tag {\n        font-family: monospace;\n        font-weight: bold;\n        color: #e67e22;\n      }\n\n      /* Navigation Button Style */\n      .nav-custom-btn {\n        background: #27ae60;\n        color: white;\n        border: none;\n        padding: 10px 20px;\n        border-radius: 4px;\n        font-size: 1rem;\n        cursor: pointer;\n        transition: background 0.2s;\n      }\n      .nav-custom-btn:hover {\n        background: #2ecc71;\n      }\n\n      @keyframes fadeIn {\n        from {\n          opacity: 0;\n        }\n        to {\n          opacity: 1;\n        }\n      }\n    </style>\n  </head>\n  <body>\n    <div class=\"container\">\n      <h1>‚õ∑Ô∏è Ski Shop Admin Panel</h1>\n      <div class=\"stats-bar\">\n        <div class=\"stat-box\">\n          <div>Total Clients</div>\n          <div id=\"totalClients\" class=\"stat-val\">-</div>\n        </div>\n        <div class=\"stat-box\">\n          <div>Registered Members</div>\n          <div id=\"totalRegistered\" class=\"stat-val\">-</div>\n        </div>\n        <div class=\"stat-box\" style=\"background: #27ae60\">\n          <div>Total Revenue</div>\n          <div id=\"totalRevenue\" class=\"stat-val\">-</div>\n        </div>\n      </div>\n\n      <h3>Client Database (Top Spenders)</h3>\n      <table>\n        <thead>\n          <tr>\n            <th width=\"150\">ID</th>\n            <th>Status</th>\n            <th>City</th>\n            <th>Age</th>\n            <th>Purchases</th>\n            <th>CRM Notes</th>\n            <th>Custom UX</th>\n            <th>Action</th>\n          </tr>\n        </thead>\n        <tbody id=\"clientTable\">\n          <tr>\n            <td colspan=\"8\">Loading data...</td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n\n    <div id=\"noteModal\" class=\"modal\">\n      <div class=\"modal-content\">\n        <span class=\"close-btn\" onclick=\"closeModal('noteModal')\">&times;</span>\n        <h3 id=\"noteModalTitle\">Notes</h3>\n        <ul id=\"noteList\" style=\"padding-left: 20px\"></ul>\n      </div>\n    </div>\n\n    <div id=\"uxModal\" class=\"modal\">\n      <div class=\"modal-content\">\n        <span class=\"close-btn\" onclick=\"closeModal('uxModal')\">&times;</span>\n        <h3 id=\"uxModalTitle\">Custom Interface Versions</h3>\n        <p style=\"color: #7f8c8d; font-size: 0.9rem; margin-bottom: 15px\">\n          Select a version configuration to launch.\n        </p>\n\n        <h4 style=\"margin: 10px 0 5px 0; border-bottom: 1px solid #eee\">\n          Home Page Variants\n        </h4>\n        <ul id=\"homeVersionList\" class=\"version-list\"></ul>\n\n        <h4 style=\"margin: 20px 0 5px 0; border-bottom: 1px solid #eee\">\n          Order Page Variants\n        </h4>\n        <ul id=\"orderVersionList\" class=\"version-list\"></ul>\n\n        <div\n          style=\"\n            margin-top: 25px;\n            text-align: right;\n            border-top: 1px solid #eee;\n            padding-top: 15px;\n          \"\n        >\n          <button onclick=\"navigateCustom()\" class=\"nav-custom-btn\">\n            Navigate to custom page ‚Üó\n          </button>\n        </div>\n      </div>\n    </div>\n\n    <script>\n      window.clientsMap = new Map();\n      let currentUxClientId = null;\n\n      async function init() {\n        const statsRes = await fetch('/api/dashboard');\n        const stats = await statsRes.json();\n        document.getElementById('totalRevenue').textContent = formatMoney(\n          stats.totalRevenue\n        );\n\n        const res = await fetch('/api/clients');\n        let clients = await res.json();\n\n        document.getElementById('totalClients').textContent = clients.length;\n        document.getElementById('totalRegistered').textContent = clients.filter(\n          (c) => c.isRegistered\n        ).length;\n\n        clients.sort((a, b) => (b.totalSpent || 0) - (a.totalSpent || 0));\n        clients.forEach((c) => window.clientsMap.set(c.id, c));\n\n        const tbody = document.getElementById('clientTable');\n        tbody.innerHTML = clients\n          .map((c) => {\n            const actionButton =\n              c.id && c.id !== 'undefined'\n                ? `<a href=\"/?clientId=${c.id}\" target=\"_blank\" class=\"impersonate-btn\">Impersonate ‚Üó</a>`\n                : `<span style=\"color:#ccc\">N/A</span>`;\n\n            let notesButton = `<span style=\"color:#ccc\">-</span>`;\n            if (c.crmNotes && c.crmNotes.length > 0) {\n              notesButton = `<button class=\"notes-btn\" onclick=\"openNoteModal('${c.id}')\">View (${c.crmNotes.length})</button>`;\n            }\n\n            let uxBadges = '';\n            const hasHome =\n              c.customHomeVersions && c.customHomeVersions.length > 0;\n            const hasOrder =\n              c.customOrderVersions && c.customOrderVersions.length > 0;\n\n            if (hasHome) {\n              uxBadges += `<button class=\"ux-btn ux-home\" onclick=\"openUxModal('${c.id}')\">Home (${c.customHomeVersions.length})</button>`;\n            }\n            if (hasOrder) {\n              uxBadges += `<button class=\"ux-btn ux-order\" onclick=\"openUxModal('${c.id}')\">Order (${c.customOrderVersions.length})</button>`;\n            }\n            if (!hasHome && !hasOrder)\n              uxBadges = `<span class=\"ux-none\">-</span>`;\n\n            return `\n                <tr>\n                    <td>${c.id || 'Unknown'}</td>\n                    <td class=\"${c.isRegistered ? 'registered' : 'guest'}\">${\n              c.isRegistered ? 'MEMBER' : 'GUEST'\n            }</td>\n                    <td>${c.city || '-'}</td>\n                    <td>${c.age || '-'}</td>\n                    <td class=\"money\">${formatMoney(c.totalSpent)}</td>\n                    <td>${notesButton}</td>\n                    <td>${uxBadges}</td>\n                    <td>${actionButton}</td>\n                </tr>\n            `;\n          })\n          .join('');\n      }\n\n      function formatMoney(amount) {\n        return (\n          '$' +\n          (amount || 0).toLocaleString(undefined, {\n            minimumFractionDigits: 2,\n            maximumFractionDigits: 2,\n          })\n        );\n      }\n\n      function openNoteModal(clientId) {\n        const client = window.clientsMap.get(clientId);\n        if (!client) return;\n        document.getElementById(\n          'noteModalTitle'\n        ).textContent = `Notes for ${client.id}`;\n        document.getElementById('noteList').innerHTML = client.crmNotes\n          .map((n) => `<li>${n}</li>`)\n          .join('');\n        document.getElementById('noteModal').classList.add('visible');\n      }\n\n      function openUxModal(clientId) {\n        currentUxClientId = clientId;\n        const client = window.clientsMap.get(clientId);\n        if (!client) return;\n\n        document.getElementById(\n          'uxModalTitle'\n        ).textContent = `UX Versions: ${client.id}`;\n\n        // Function to create radio button HTML\n        const createRadio = (hash, group, isDefault = false) => {\n          const val = isDefault ? '' : hash;\n          const display = isDefault\n            ? 'Standard / Default'\n            : `Version: <span class=\"version-tag\">${hash.substring(\n                0,\n                8\n              )}...</span>`;\n          const checked = isDefault ? 'checked' : '';\n\n          return `\n             <li>\n               <label>\n                 <input type=\"radio\" name=\"${group}\" value=\"${val}\" ${checked}>\n                 ${display}\n               </label>\n             </li>`;\n        };\n\n        // Render Home Options\n        const homeList = document.getElementById('homeVersionList');\n        let homeHtml = createRadio(null, 'homeHash', true); // Default option\n        if (client.customHomeVersions && client.customHomeVersions.length) {\n          homeHtml += client.customHomeVersions\n            .map((h) => createRadio(h, 'homeHash'))\n            .join('');\n        }\n        homeList.innerHTML = homeHtml;\n\n        // Render Order Options\n        const orderList = document.getElementById('orderVersionList');\n        let orderHtml = createRadio(null, 'orderHash', true); // Default option\n        if (client.customOrderVersions && client.customOrderVersions.length) {\n          orderHtml += client.customOrderVersions\n            .map((h) => createRadio(h, 'orderHash'))\n            .join('');\n        }\n        orderList.innerHTML = orderHtml;\n\n        document.getElementById('uxModal').classList.add('visible');\n      }\n\n      function navigateCustom() {\n        if (!currentUxClientId) return;\n\n        // Helper to get checked value\n        const getSelected = (name) => {\n          const el = document.querySelector(`input[name=\"${name}\"]:checked`);\n          return el ? el.value : '';\n        };\n\n        const homeHash = getSelected('homeHash');\n        const orderHash = getSelected('orderHash');\n\n        let url = `/?clientId=${currentUxClientId}`;\n\n        if (homeHash) {\n          url += `&homeHash=${homeHash}`;\n        }\n\n        if (orderHash) {\n          url += `&orderHash=${orderHash}`;\n        }\n\n        window.open(url, '_blank');\n      }\n\n      function closeModal(id) {\n        document.getElementById(id).classList.remove('visible');\n      }\n\n      window.onclick = function (event) {\n        if (event.target.classList.contains('modal')) {\n          event.target.classList.remove('visible');\n        }\n      };\n\n      init();\n    </script>\n  </body>\n</html>\n\n\n// --- FILE: app.js ---\n// STATE\nconst state = {\n  clientId: null,\n  deviceId: null,\n  clientProfile: null,\n  deviceProfile: null,\n  inventory: [],\n};\n\n// --- INITIALIZATION ---\nasync function init() {\n  const urlParams = new URLSearchParams(window.location.search);\n\n  // 1. Setup Client\n  state.clientId = urlParams.get('clientId');\n  if (!state.clientId) {\n    state.clientId =\n      'CLIENT-' +\n      Math.floor(Math.random() * 100000)\n        .toString()\n        .padStart(5, '0');\n  }\n\n  // 2. Fetch Client Profile Info\n  try {\n    const res = await fetch(`/api/clients/${state.clientId}`);\n    if (res.ok) {\n      state.clientProfile = await res.json();\n      state.deviceId = state.clientProfile.devices?.[0] || generateDeviceId();\n    } else {\n      state.deviceId = generateDeviceId();\n    }\n  } catch (e) {\n    state.deviceId = generateDeviceId();\n  }\n\n  // 3. Fetch Device Profile Info\n  try {\n    const devRes = await fetch(`/api/devices/${state.deviceId}`);\n    if (devRes.ok) {\n      state.deviceProfile = await devRes.json();\n    } else {\n      // Mock if not found in DB yet\n      state.deviceProfile = {\n        id: state.deviceId,\n        browser: navigator.userAgent,\n        deviceName: 'Current Session',\n      };\n    }\n  } catch (e) {\n    console.log(e);\n  }\n\n  // 4. Update UI Header\n  document.getElementById(\n    'displayClient'\n  ).textContent = `Client: ${state.clientId}`;\n  document.getElementById(\n    'displayDevice'\n  ).textContent = `Device: ${state.deviceId}`;\n  document.getElementById('displayLocation').textContent = `Location: ${\n    state.clientProfile ? state.clientProfile.city : 'Unknown (Guest)'\n  }`;\n\n  // 5. Pass Client ID to Order Component\n  document\n    .getElementById('orderPage')\n    .setAttribute('client-id', state.clientId);\n\n  // 6. Initial Route\n  const initialPage = urlParams.get('page') || 'home';\n  const itemId = urlParams.get('itemId');\n\n  // 7. Initialize Tooltips\n  setupTooltips();\n\n  updateUrl(initialPage, itemId, true);\n  render(initialPage, itemId);\n}\n\nfunction generateDeviceId() {\n  return 'DEV-' + Math.floor(Math.random() * 100000);\n}\n\n// --- Initialize Client & Device Info Tooltips ---\nfunction setupTooltips() {\n  const tooltip = document.getElementById('detailTooltip');\n\n  const attach = (id, getDataFn) => {\n    const el = document.getElementById(id);\n    el.addEventListener('mouseenter', () => {\n      const data = getDataFn();\n      // Pretty print JSON\n      tooltip.textContent = JSON.stringify(data, null, 2);\n      tooltip.classList.add('visible');\n    });\n    el.addEventListener('mouseleave', () => {\n      tooltip.classList.remove('visible');\n    });\n  };\n\n  // Define what data shows for each span\n  attach('displayClient', () => state.clientProfile);\n  attach(\n    'displayDevice',\n    () => state.deviceProfile || { id: state.deviceId, note: 'Not tracked yet' }\n  );\n  attach('displayLocation', () => ({\n    city: state.clientProfile?.city || 'Unknown',\n    registered: state.clientProfile?.isRegistered || false,\n  }));\n}\n\n// --- NAVIGATION HANDLERS ---\n\n// Listen for custom events from Web Components\ndocument.addEventListener('navigate-order', (e) => {\n  // The Home Page requests to navigate to Order Page with a specific item\n  router('order', e.detail.item.id, e.detail.item);\n});\n\ndocument.addEventListener('navigate-home', () => {\n  router('home');\n});\n\ndocument.addEventListener('order-completed', () => {\n  // Refresh inventory on home page silently\n  const home = document.getElementById('homePage');\n  if (home.loadInventory) home.loadInventory();\n\n  router('history');\n});\n\n// Standard Router Logic\nwindow.router = function (pageId, itemId = null, itemObj = null) {\n  updateUrl(pageId, itemId);\n  render(pageId, itemId, itemObj);\n};\n\nfunction updateUrl(pageId, itemId = null, replace = false) {\n  // Preserve existing params (like homeHash, orderHash) by initializing with window.location.search\n  const params = new URLSearchParams(window.location.search);\n  \n  if (state.clientId) params.set('clientId', state.clientId);\n  if (pageId) params.set('page', pageId);\n  \n  if (itemId) {\n    params.set('itemId', itemId);\n  } else {\n    params.delete('itemId');\n  }\n\n  const newUrl = `${window.location.pathname}?${params.toString()}`;\n  \n  replace\n    ? window.history.replaceState({ pageId, itemId }, '', newUrl)\n    : window.history.pushState({ pageId, itemId }, '', newUrl);\n}\n\nwindow.onpopstate = function (event) {\n  if (event.state) render(event.state.pageId, event.state.itemId);\n  else render('home');\n};\n\nasync function render(pageId, itemId, itemObj = null) {\n  const homeEl = document.getElementById('homePage');\n  const orderEl = document.getElementById('orderPage');\n  const historyEl = document.getElementById('historyPage');\n\n  // Reset visibility\n  homeEl.classList.add('hidden');\n  orderEl.classList.add('hidden');\n  historyEl.classList.add('hidden');\n\n  if (pageId === 'home') {\n    homeEl.classList.remove('hidden');\n  } else if (pageId === 'order') {\n    orderEl.classList.remove('hidden');\n\n    // Ensure data is loaded into component\n    if (itemObj) {\n      orderEl.loadItem(itemObj);\n    } else if (itemId) {\n      // If deep linked, fetch item data first\n      const res = await fetch('/api/inventory');\n      const inventory = await res.json();\n      const item = inventory.find((i) => i.id === itemId);\n      if (item) orderEl.loadItem(item);\n    }\n  } else if (pageId === 'history') {\n    historyEl.classList.remove('hidden');\n    loadHistory();\n  }\n}\n\n// History Page Logic (kept in main app as requested implicitly)\nasync function loadHistory() {\n  const tbody = document.getElementById('historyBody');\n  tbody.innerHTML = '<tr><td colspan=\"5\">Loading...</td></tr>';\n  const res = await fetch(`/api/orders?clientId=${state.clientId}`);\n  const orders = await res.json();\n  if (orders.length === 0) {\n    tbody.innerHTML =\n      '<tr><td colspan=\"5\" style=\"text-align:center\">No orders found.</td></tr>';\n    return;\n  }\n  orders.reverse();\n  tbody.innerHTML = orders\n    .map(\n      (order) => `\n        <tr>\n            <td>${order.id}</td>\n            <td>${new Date().toLocaleDateString()}</td>\n            <td>${order.items.map((i) => `${i.qty}x`).join(', ')}</td>\n            <td>$${order.orderTotal.toFixed(2)}</td>\n            <td class=\"status-${order.status.toLowerCase()}\">${\n        order.status\n      }</td>\n        </tr>\n    `\n    )\n    .join('');\n}\n\ninit();\n\n// --- FILE: components\\homePage.js ---\nclass HomePage extends HTMLElement {\n  constructor() {\n    super();\n    this.attachShadow({ mode: 'open' });\n  }\n\n  connectedCallback() {\n    this.render();\n    this.loadInventory();\n  }\n\n  async loadInventory() {\n    const grid = this.shadowRoot.getElementById('productGrid');\n    grid.innerHTML = 'Loading inventory...';\n\n    try {\n      const res = await fetch('/api/inventory');\n      const inventory = await res.json();\n\n      grid.innerHTML = inventory\n        .map(\n          (item) => `\n                <div class=\"card\">\n                    <h3>${item.name}</h3>\n                    <p class=\"stock\">${\n                      item.stock > 0\n                        ? 'In Stock: ' + item.stock\n                        : 'Out of Stock'\n                    }</p>\n                    <p class=\"price\">$${item.cost * 1.5}</p>\n                    <button \n                        class=\"buy-btn\" \n                        data-id=\"${item.id}\"\n                        ${item.stock <= 0 ? 'disabled' : ''}>\n                        ${item.stock > 0 ? 'Buy Now' : 'Sold Out'}\n                    </button>\n                </div>\n            `\n        )\n        .join('');\n\n      // Add Event Listeners to Buttons\n      this.shadowRoot.querySelectorAll('.buy-btn').forEach((btn) => {\n        btn.addEventListener('click', (e) => {\n          const itemId = e.target.dataset.id;\n          const item = inventory.find((i) => i.id === itemId);\n\n          // Dispatch event to parent (app.js)\n          this.dispatchEvent(\n            new CustomEvent('navigate-order', {\n              detail: { item: item },\n              bubbles: true,\n              composed: true,\n            })\n          );\n        });\n      });\n    } catch (e) {\n      grid.innerHTML = '<p>Error loading inventory.</p>';\n    }\n  }\n\n  render() {\n    this.shadowRoot.innerHTML = `\n        <style>\n            :host { display: block; animation: fadeIn 0.3s; }\n            .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }\n            .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-align: center; font-family: 'Segoe UI', sans-serif; }\n            .card h3 { margin: 0 0 10px 0; color: #2c3e50; }\n            .price { font-size: 1.2rem; color: #e74c3c; font-weight: bold; }\n            .stock { color: #7f8c8d; font-size: 0.9rem; margin-bottom: 15px; }\n            button { background: #3498db; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; width: 100%; font-size: 1rem; }\n            button:hover { background: #2980b9; }\n            button:disabled { background: #ccc; cursor: not-allowed; }\n            @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }\n        </style>\n\n        <h2>Featured Skis</h2>\n        <div id=\"productGrid\" class=\"grid\"></div>\n        `;\n  }\n}\n\ncustomElements.define('home-page', HomePage);\n\n\n// --- FILE: components\\orderPage.js ---\nclass OrderPage extends HTMLElement {\n  constructor() {\n    super();\n    this.attachShadow({ mode: 'open' });\n    this.selectedItem = null;\n    this.clientId = null;\n  }\n\n  connectedCallback() {\n    this.render();\n    this.clientId = this.getAttribute('client-id');\n  }\n\n  static get observedAttributes() {\n    return ['client-id'];\n  }\n\n  attributeChangedCallback(name, oldValue, newValue) {\n    if (name === 'client-id') {\n      this.clientId = newValue;\n    }\n  }\n\n  // Public method called by Router\n  loadItem(item) {\n    this.selectedItem = item;\n    const price = item.cost * 1.5;\n\n    // Populate DOM in Shadow Root\n    const root = this.shadowRoot;\n    root.getElementById('orderItemName').textContent = item.name;\n    root.getElementById('orderItemSku').textContent = item.sku;\n    root.getElementById('orderItemPrice').textContent = `$${price}`;\n    root.getElementById('orderTotal').textContent = price;\n\n    const qtySelect = root.getElementById('orderQty');\n    qtySelect.value = '1';\n\n    qtySelect.onchange = () => {\n      root.getElementById('orderTotal').textContent = (\n        price * qtySelect.value\n      ).toFixed(2);\n    };\n  }\n\n  async submitOrder() {\n    const root = this.shadowRoot;\n    const qty = parseInt(root.getElementById('orderQty').value);\n    const price = this.selectedItem.cost * 1.5;\n    const btn = root.getElementById('btnConfirm');\n\n    btn.disabled = true;\n    btn.textContent = 'Processing...';\n\n    const payload = {\n      clientId: this.clientId,\n      items: [{ skuId: this.selectedItem.id, quantity: qty, price: price }],\n    };\n\n    try {\n      const res = await fetch('/api/orders', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(payload),\n      });\n      const data = await res.json();\n\n      if (data.success) {\n        alert('Order Confirmed! ID: ' + data.orderId);\n        this.dispatchEvent(\n          new CustomEvent('order-completed', { bubbles: true, composed: true })\n        );\n      } else {\n        alert('Error: ' + data.error);\n      }\n    } catch (e) {\n      alert('Network Error');\n    } finally {\n      btn.disabled = false;\n      btn.textContent = 'Confirm Purchase';\n    }\n  }\n\n  render() {\n    this.shadowRoot.innerHTML = `\n        <style>\n            :host { display: block; animation: fadeIn 0.3s; font-family: 'Segoe UI', sans-serif; }\n            .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-align: center; max-width: 500px; margin: 0 auto; text-align: left; }\n            .card h3 { margin: 0 0 10px 0; color: #2c3e50; }\n            .price { font-size: 1.2rem; color: #e74c3c; font-weight: bold; }\n            hr { border: 0; border-top: 1px solid #eee; margin: 15px 0; }\n            button { background: #3498db; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; width: 100%; font-size: 1rem; margin-top: 10px; }\n            button:hover { background: #2980b9; }\n            button:disabled { background: #ccc; cursor: not-allowed; }\n            .cancel-btn { background: #95a5a6; }\n            .cancel-btn:hover { background: #7f8c8d; }\n            select { width: 100%; padding: 8px; margin: 10px 0; border: 1px solid #ccc; border-radius: 4px; }\n            @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }\n        </style>\n\n        <h2>Complete Your Order</h2>\n        <div class=\"card\">\n            <h3 id=\"orderItemName\">Ski Name</h3>\n            <p>SKU: <span id=\"orderItemSku\"></span></p>\n            <p>Price: <span id=\"orderItemPrice\" class=\"price\"></span></p>\n            <hr>\n            <label>Quantity:</label>\n            <select id=\"orderQty\">\n                <option value=\"1\">1</option>\n                <option value=\"2\">2</option>\n                <option value=\"3\">3</option>\n            </select>\n            <button id=\"btnConfirm\">Confirm Purchase ($<span id=\"orderTotal\"></span>)</button>\n            <button class=\"cancel-btn\" id=\"btnCancel\">Cancel</button>\n        </div>\n        `;\n\n    this.shadowRoot.getElementById('btnConfirm').onclick = () =>\n      this.submitOrder();\n    this.shadowRoot.getElementById('btnCancel').onclick = () => {\n      this.dispatchEvent(\n        new CustomEvent('navigate-home', { bubbles: true, composed: true })\n      );\n    };\n  }\n}\n\ncustomElements.define('order-page', OrderPage);\n\n\n// --- FILE: index.html ---\n<!DOCTYPE html>\n<html lang=\"en\">\n  <head>\n    <meta charset=\"UTF-8\" />\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n    <title>Alpine Ski Shop</title>\n    <style>\n      /* ... Existing Styles ... */\n      body {\n        font-family: 'Segoe UI', sans-serif;\n        margin: 0;\n        padding: 0;\n        background: #f4f7f6;\n        color: #333;\n      }\n      header {\n        background: #2c3e50;\n        color: white;\n        padding: 1rem 2rem;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n      }\n      header nav a {\n        color: #ecf0f1;\n        text-decoration: none;\n        margin-left: 20px;\n        font-weight: bold;\n        cursor: pointer;\n      }\n      header nav a:hover {\n        text-decoration: underline;\n      }\n      .container {\n        max-width: 1000px;\n        margin: 2rem auto;\n        padding: 0 1rem;\n      }\n      .client-info {\n        background: #fff;\n        padding: 10px 2rem;\n        border-bottom: 1px solid #ddd;\n        font-size: 0.9rem;\n        display: flex;\n        gap: 20px;\n        color: #555;\n        position: relative;\n      }\n      .hidden {\n        display: none !important;\n      }\n      .info-hover {\n        cursor: help;\n        border-bottom: 1px dotted #aaa;\n        position: relative;\n      }\n      .info-hover:hover {\n        color: #2c3e50;\n        font-weight: bold;\n      }\n      #detailTooltip {\n        position: absolute;\n        top: 45px;\n        left: 20px;\n        background: #2c3e50;\n        color: #ecf0f1;\n        padding: 15px;\n        border-radius: 5px;\n        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);\n        z-index: 1000;\n        min-width: 250px;\n        white-space: pre-wrap;\n        font-family: 'Consolas', monospace;\n        font-size: 0.8rem;\n        display: none;\n      }\n      #detailTooltip.visible {\n        display: block;\n        animation: fadeIn 0.2s;\n      }\n\n      /* Table styles for history */\n      table {\n        width: 100%;\n        border-collapse: collapse;\n        background: white;\n        border-radius: 8px;\n        overflow: hidden;\n      }\n      th,\n      td {\n        padding: 12px 15px;\n        text-align: left;\n        border-bottom: 1px solid #ddd;\n      }\n      th {\n        background: #ecf0f1;\n      }\n      .status-confirmed {\n        color: green;\n        font-weight: bold;\n      }\n    </style>\n  </head>\n  <body>\n    <header>\n      <div>üéø <strong>Alpine Ski Shop</strong></div>\n      <nav>\n        <a onclick=\"router('home')\">Shop</a>\n        <a onclick=\"router('history')\">My Orders</a>\n      </nav>\n    </header>\n\n    <div class=\"client-info\">\n      <span id=\"displayClient\" class=\"info-hover\">Client: ...</span>\n      <span id=\"displayDevice\" class=\"info-hover\">Device: ...</span>\n      <span id=\"displayLocation\" class=\"info-hover\">Location: ...</span>\n      <div id=\"detailTooltip\"></div>\n    </div>\n\n    <div class=\"container\">\n      <home-page id=\"homePage\"></home-page>\n      <order-page id=\"orderPage\" class=\"hidden\"></order-page>\n      <div id=\"historyPage\" class=\"hidden\">\n        <h2>Purchase History</h2>\n        <table id=\"historyTable\">\n          <thead>\n            <tr>\n              <th>Order ID</th>\n              <th>Date</th>\n              <th>Items</th>\n              <th>Total</th>\n              <th>Status</th>\n            </tr>\n          </thead>\n          <tbody id=\"historyBody\"></tbody>\n        </table>\n      </div>\n    </div>\n\n    <script type=\"module\">\n      (async function () {\n        const params = new URLSearchParams(window.location.search);\n        const clientId = params.get('clientId');\n\n        // --- VERSION CONTROL ---\n        // 1. Check URL for specific version override\n        // 2. Fallback to 'legacy' (or hardcoded default)\n        const HOME_COMPONENT_HASH = params.get('homeHash') || 'legacy';\n        const ORDER_COMPONENT_HASH = params.get('orderHash') || 'legacy';\n\n        const getComponentSrc = async (\n          defaultSrc,\n          dynamicFolder,\n          fileName,\n          targetHash\n        ) => {\n          if (clientId && targetHash) {\n            // Construct path: ./components/dynamicHome/{hash}/homePage-{id}.js\n            const dynamicSrc = `${dynamicFolder}/${targetHash}/${fileName}`;\n            try {\n              const response = await fetch(dynamicSrc, { method: 'HEAD' });\n              if (response.ok) {\n                console.log(\n                  `%c Loaded Dynamic Component (${targetHash})`,\n                  'color: green; font-weight: bold;'\n                );\n                return dynamicSrc;\n              }\n            } catch (e) {\n              console.warn(\n                `Dynamic component not found in ${targetHash}, using default.`\n              );\n            }\n          }\n          return defaultSrc;\n        };\n\n        const [homeSrc, orderSrc] = await Promise.all([\n          getComponentSrc(\n            './components/homePage.js',\n            './components/dynamicHome',\n            `homePage-${clientId}.js`,\n            HOME_COMPONENT_HASH\n          ),\n          getComponentSrc(\n            './components/orderPage.js',\n            './components/dynamicOrder',\n            `orderPage-${clientId}.js`,\n            ORDER_COMPONENT_HASH\n          ),\n        ]);\n\n        await import(homeSrc);\n        await import(orderSrc);\n      })();\n    </script>\n\n    <script src=\"app.js\"></script>\n  </body>\n</html>\n\n"}]}]}}